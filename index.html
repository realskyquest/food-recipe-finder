<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Food Recipe Finder</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" />
  </head>
  <body>
    <div class="w3-container w3-center w3-margin-bottom w3-dark-gray">
      <h1>Food Recipe Finder</h1>
    </div>

    <div class="w3-container w3-dark-grey w3-margin">
        <div class="w3-row-padding w3-center w3-margin w3-dark-gray">
            <div class="w3-half">
              <div class="w3-card w3-margin">
                <input type="text" placeholder="Enter a food" id="search-bar" class="w3-input" style="text-align: center;"/>
              </div>
            </div>
            <div class="w3-half">
              <div class="w3-card w3-left-align w3-margin">
                <button id="search-btn" class="w3-button w3-block w3-gray">Search</button>
              </div>
            </div>
          </div>
    </div>

    <div id="searchResults" class="w3-content"></div>

    <div class="w3-container w3-dark-grey">
      <div class="w3-panel w3-red">
        <p>
          Recipe's may not be shown if the API is overloaded<br>
          Edamam's Recipe Search API<br>
          API calls limits = 10,000 month<br>
          Throttling calls/min = 10/minute<br>
        </p>
      </div>       
      <div class="w3-panel w3-leftbar w3-white">
        <p>
          <i>By skyquest</i> -
          <a
            href="https://github.com/realskyquest/food-recipe-finder"
            style="color: darkblue"
            >Github</a
          >
        </p>
      </div>
    </div>

    <script>
      const searchResult = document.querySelector("#searchResults");
      const searchBtn = document.querySelector("#search-btn");
      const searchBar = document.querySelector("#search-bar");

      searchBtn.addEventListener("click", () => {
        const food = searchBar.value;
        GetRecipeData(food);
      });

      const ID = "a475e62e";
      const key = "0207e33a4ec6161825a143c43fa12b6e";

      async function GetRecipeData(searchData) {
        const baseUrl = `https://api.edamam.com/search?q=${searchData}&app_id=${ID}&app_key=${key}`;
        const response = await fetch(baseUrl);
        const data = await response.json();
        ShowRecipes(data.hits);
        console.log(data);
      }

      function ShowRecipes(results) {
        let initialContent = "";
        results.map((result) => {
          initialContent += `
          <div class="w3-row w3-margin w3-dark-grey">
            <div class="w3-third">
                <div class="w3-container w3-margin">
                    <img src="${result.recipe.image}" class="w3-round-xlarge" style="width:100%;min-height:200px">
                </div>
            </div>
            <div class="w3-twothird w3-container">
                <div class="w3-container w3-margin w3-white w3-round-xlarge">
                  <div class="w3-green w3-round-large">
                    <h1>${result.recipe.label}</h1>
                  </div>
                  <div class="w3-panel w3-pale-blue w3-leftbar w3-rightbar w3-border-blue">
                    <p style="margin: 0"><a href='${result.recipe.url}'>View Recipe</a></p>
                  </div>
                  <div class="w3-panel w3-leftbar w3-pale-red w3-border-red">
                    <p style="margin: 0;">Cautions : ${result.recipe.cautions.join(', ')}</p>
                  </div>
                  <div class="w3-container w3-blue w3-margin-bottom w3-margin-top w3-round-large">
                    <p style="margin: 0;">Calories : ${result.recipe.calories.toFixed(2)}</p>
                    <p style="margin: 0;">Total Weight : ${result.recipe.totalWeight.toFixed(2)}</p>
                    <p style="margin: 0;">Energy : ${result.recipe.totalNutrients.ENERC_KCAL.quantity.toFixed(2)} ${result.recipe.totalNutrients.ENERC_KCAL.unit}</p>
                    <p style="margin: 0;">Fat : ${result.recipe.totalNutrients.FAT.quantity.toFixed(2)} ${result.recipe.totalNutrients.FAT.unit}</p>
                  </div>
                </div>
            </div>
          </div>`;
        });

        searchResult.innerHTML = initialContent;
      }

    </script>
  </body>
</html>
